"use strict";
/* eslint-disable import/order */
Object.defineProperty(exports, "__esModule", { value: true });
const mockGarbageCollect = jest.fn();
const api_1 = require("../../lib/api");
const stack_refresh_1 = require("../../lib/api/garbage-collection/stack-refresh");
const mock_sdk_1 = require("../util/mock-sdk");
let garbageCollector;
let mockListStacks;
let mockDescribeStacks;
let mockGetTemplateSummary;
let mockGetTemplate;
let mockListObjectsV2;
let mockGetObjectTagging;
let mockDeleteObjects;
let mockDeleteObjectTagging;
let mockPutObjectTagging;
let mockBatchDeleteImage;
let mockBatchGetImage;
let mockPutImage;
let mockListImages;
let mockDescribeImages;
let stderrMock;
let sdk;
const DAY = 24 * 60 * 60 * 1000; // Number of milliseconds in a day
function mockTheToolkitInfo(stackProps) {
    const mockSdk = new mock_sdk_1.MockSdk();
    api_1.ToolkitInfo.lookup = jest.fn().mockResolvedValue(api_1.ToolkitInfo.fromStack((0, mock_sdk_1.mockBootstrapStack)(mockSdk, stackProps)));
}
function gc(props) {
    return new api_1.GarbageCollector({
        sdkProvider: sdk,
        action: props.action,
        resolvedEnvironment: {
            account: '123456789012',
            region: 'us-east-1',
            name: 'mock',
        },
        bootstrapStackName: 'GarbageStack',
        rollbackBufferDays: props.rollbackBufferDays ?? 0,
        createdBufferDays: props.createdAtBufferDays ?? 0,
        type: props.type,
        confirm: false,
    });
}
function setupCFNGarbageCollectionMocks(mockSdk) {
    mockListStacks = jest.fn().mockResolvedValue({
        StackSummaries: [
            { StackName: 'Stack1', StackStatus: 'CREATE_COMPLETE' },
            { StackName: 'Stack2', StackStatus: 'UPDATE_COMPLETE' },
        ],
    });
    mockGetTemplateSummary = jest.fn().mockReturnValue({
        Parameters: [{
                ParameterKey: 'BootstrapVersion',
                DefaultValue: '/cdk-bootstrap/abcde/version',
            }],
    });
    mockGetTemplate = jest.fn().mockReturnValue({
        TemplateBody: 'abcde',
    });
    mockDescribeStacks = jest.fn();
    mockSdk.stubCloudFormation({
        listStacks: mockListStacks,
        getTemplateSummary: mockGetTemplateSummary,
        getTemplate: mockGetTemplate,
        describeStacks: mockDescribeStacks,
    });
    return {
        mockListStacks,
        mockGetTemplateSummary,
        mockGetTemplate,
        mockDescribeStacks,
    };
}
function setupS3GarbageCollectionMocks(mockSdk) {
    const mocks = setupCFNGarbageCollectionMocks(mockSdk);
    mockListObjectsV2 = jest.fn().mockImplementation(() => {
        return Promise.resolve({
            Contents: [
                { Key: 'asset1', LastModified: new Date(Date.now() - (2 * DAY)) },
                { Key: 'asset2', LastModified: new Date(Date.now() - (10 * DAY)) },
                { Key: 'asset3', LastModified: new Date(Date.now() - (100 * DAY)) },
            ],
            KeyCount: 3,
        });
    });
    mockGetObjectTagging = jest.fn().mockImplementation((params) => {
        return Promise.resolve({
            TagSet: params.Key === 'asset2' ? [{ Key: api_1.S3_ISOLATED_TAG, Value: new Date().toISOString() }] : [],
        });
    });
    mockPutObjectTagging = jest.fn();
    mockDeleteObjects = jest.fn();
    mockDeleteObjectTagging = jest.fn();
    mockSdk.stubS3({
        listObjectsV2: mockListObjectsV2,
        getObjectTagging: mockGetObjectTagging,
        deleteObjects: mockDeleteObjects,
        deleteObjectTagging: mockDeleteObjectTagging,
        putObjectTagging: mockPutObjectTagging,
    });
    return {
        ...mocks,
        mockListObjectsV2,
        mockGetObjectTagging,
        mockDeleteObjects,
        mockDeleteObjectTagging,
        mockPutObjectTagging,
    };
}
function setupEcrGarbageCollectionMocks(mockSdk) {
    const mocks = setupCFNGarbageCollectionMocks(mockSdk);
    mockBatchGetImage = jest.fn().mockImplementation(() => {
        return Promise.resolve({
            images: [
                { imageId: { imageDigest: 'digest1' }, imageManifest: {} },
                { imageId: { imageDigest: 'digest2' }, imageManifest: {} },
                { imageId: { imageDigest: 'digest3' }, imageManifest: {} },
            ],
        });
    });
    mockDescribeImages = jest.fn().mockImplementation(() => {
        return Promise.resolve({
            imageDetails: [
                { imageDigest: 'digest3', imageTags: ['klmno'], imagePushedAt: Date.now() - (2 * DAY), imageSizeInBytes: 100 },
                { imageDigest: 'digest2', imageTags: ['fghij'], imagePushedAt: Date.now() - (10 * DAY), imageSizeInBytes: 300000000 },
                { imageDigest: 'digest1', imageTags: ['abcde'], imagePushedAt: Date.now() - (100 * DAY), imageSizeInBytes: 1000000000 },
            ],
        });
    });
    mockBatchDeleteImage = jest.fn();
    mockPutImage = jest.fn();
    mockListImages = jest.fn().mockImplementation(() => {
        return Promise.resolve({
            imageIds: [
                { imageDigest: 'digest1', imageTag: 'abcde' }, // inuse
                { imageDigest: 'digest2', imageTag: 'fghij' },
                { imageDigest: 'digest3', imageTag: 'klmno' },
            ],
        });
    });
    mockSdk.stubEcr({
        batchGetImage: mockBatchGetImage,
        describeImages: mockDescribeImages,
        batchDeleteImage: mockBatchDeleteImage,
        putImage: mockPutImage,
        listImages: mockListImages,
    });
    return {
        ...mocks,
        mockDescribeImages,
        mockBatchDeleteImage,
        mockPutImage,
        mockListImages,
    };
}
beforeEach(() => {
    sdk = new mock_sdk_1.MockSdkProvider({ realSdk: false });
    // By default, we'll return a non-found toolkit info
    api_1.ToolkitInfo.lookup = jest.fn().mockResolvedValue(api_1.ToolkitInfo.bootstrapStackNotFoundInfo('GarbageStack'));
    stderrMock = jest.spyOn(process.stderr, 'write').mockImplementation(() => { return true; });
});
afterEach(() => {
    stderrMock.mockRestore();
});
describe('S3 Garbage Collection', () => {
    let mocks;
    beforeEach(() => {
        mocks = setupS3GarbageCollectionMocks(sdk);
    });
    afterEach(() => {
        mockGarbageCollect.mockClear();
    });
    test('rollbackBufferDays = 0 -- assets to be deleted', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        expect(mocks.mockListObjectsV2).toHaveBeenCalledTimes(2);
        // no tagging
        expect(mocks.mockGetObjectTagging).toHaveBeenCalledTimes(0);
        expect(mocks.mockPutObjectTagging).toHaveBeenCalledTimes(0);
        // assets are to be deleted
        expect(mocks.mockDeleteObjects).toHaveBeenCalledWith({
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    { Key: 'asset1' },
                    { Key: 'asset2' },
                    { Key: 'asset3' },
                ],
                Quiet: true,
            },
        });
    });
    test('rollbackBufferDays > 0 -- assets to be tagged', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        expect(mocks.mockListObjectsV2).toHaveBeenCalledTimes(2);
        // assets tagged
        expect(mocks.mockGetObjectTagging).toHaveBeenCalledTimes(3);
        expect(mocks.mockPutObjectTagging).toHaveBeenCalledTimes(2); // one asset already has the tag
        // no deleting
        expect(mocks.mockDeleteObjects).toHaveBeenCalledTimes(0);
    });
    test('createdAtBufferDays > 0', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            createdAtBufferDays: 5,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockDeleteObjects).toHaveBeenCalledWith({
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    // asset1 not deleted because it is too young
                    { Key: 'asset2' },
                    { Key: 'asset3' },
                ],
                Quiet: true,
            },
        });
    });
    test('action = print -- does not tag or delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'print',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        expect(mocks.mockListObjectsV2).toHaveBeenCalledTimes(2);
        // get tags, but dont put tags
        expect(mocks.mockGetObjectTagging).toHaveBeenCalledTimes(3);
        expect(mocks.mockPutObjectTagging).toHaveBeenCalledTimes(0);
        // no deleting
        expect(mocks.mockDeleteObjects).toHaveBeenCalledTimes(0);
    });
    test('action = tag -- does not delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        expect(mocks.mockListObjectsV2).toHaveBeenCalledTimes(2);
        // tags objects
        expect(mocks.mockGetObjectTagging).toHaveBeenCalledTimes(3);
        expect(mocks.mockPutObjectTagging).toHaveBeenCalledTimes(2); // one object already has the tag
        // no deleting
        expect(mocks.mockDeleteObjects).toHaveBeenCalledTimes(0);
    });
    test('action = delete-tagged -- does not tag', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'delete-tagged',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        expect(mocks.mockListObjectsV2).toHaveBeenCalledTimes(2);
        // get tags, but dont put tags
        expect(mocks.mockGetObjectTagging).toHaveBeenCalledTimes(3);
        expect(mocks.mockPutObjectTagging).toHaveBeenCalledTimes(0);
    });
    test('ignore objects that are modified after gc start', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        const mockListObjectsV2Future = jest.fn().mockImplementation(() => {
            return Promise.resolve({
                Contents: [
                    { Key: 'asset1', LastModified: new Date(0) },
                    { Key: 'asset2', LastModified: new Date(0) },
                    { Key: 'asset3', LastModified: new Date(new Date().setFullYear(new Date().getFullYear() + 1)) }, // future date ignored everywhere
                ],
                KeyCount: 3,
            });
        });
        sdk.stubS3({
            listObjectsV2: mockListObjectsV2Future,
            getObjectTagging: mockGetObjectTagging,
            deleteObjects: mockDeleteObjects,
            putObjectTagging: mockPutObjectTagging,
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        // assets are to be deleted
        expect(mocks.mockDeleteObjects).toHaveBeenCalledWith({
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    { Key: 'asset1' },
                    { Key: 'asset2' },
                    // no asset3
                ],
                Quiet: true,
            },
        });
    });
});
describe('ECR Garbage Collection', () => {
    let mocks;
    beforeEach(() => {
        mocks = setupEcrGarbageCollectionMocks(sdk);
    });
    test('rollbackBufferDays = 0 -- assets to be deleted', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockDescribeImages).toHaveBeenCalledTimes(1);
        expect(mocks.mockListImages).toHaveBeenCalledTimes(2);
        // no tagging
        expect(mocks.mockPutImage).toHaveBeenCalledTimes(0);
        // assets are to be deleted
        expect(mocks.mockBatchDeleteImage).toHaveBeenCalledWith({
            repositoryName: 'REPO_NAME',
            imageIds: [
                { imageDigest: 'digest3' },
                { imageDigest: 'digest2' },
            ],
        });
    });
    test('rollbackBufferDays > 0 -- assets to be tagged', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        // assets tagged
        expect(mocks.mockPutImage).toHaveBeenCalledTimes(2);
        // no deleting
        expect(mocks.mockBatchDeleteImage).toHaveBeenCalledTimes(0);
    });
    test('createdAtBufferDays > 0', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            createdAtBufferDays: 5,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockBatchDeleteImage).toHaveBeenCalledWith({
            repositoryName: 'REPO_NAME',
            imageIds: [
                // digest3 is too young to be deleted
                { imageDigest: 'digest2' },
            ],
        });
    });
    test('action = print -- does not tag or delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'print',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        // dont put tags
        expect(mocks.mockPutImage).toHaveBeenCalledTimes(0);
        // no deleting
        expect(mocks.mockBatchDeleteImage).toHaveBeenCalledTimes(0);
    });
    test('action = tag -- does not delete', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        // tags objects
        expect(mocks.mockPutImage).toHaveBeenCalledTimes(2);
        // no deleting
        expect(mocks.mockBatchDeleteImage).toHaveBeenCalledTimes(0);
    });
    test('action = delete-tagged -- does not tag', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'delete-tagged',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        // dont put tags
        expect(mocks.mockPutImage).toHaveBeenCalledTimes(0);
    });
    test('ignore images that are modified after gc start', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        const mockDescribeImagesFuture = jest.fn().mockImplementation(() => {
            return Promise.resolve({
                imageDetails: [
                    { imageDigest: 'digest3', imageTags: ['klmno'], imagePushedAt: Date.now() - (2 * DAY), imageSizeInBytes: 100 },
                    { imageDigest: 'digest2', imageTags: ['fghij'], imagePushedAt: Number(new Date().setFullYear(new Date().getFullYear() + 1).toString()), imageSizeInBytes: 300000000 },
                    { imageDigest: 'digest1', imageTags: ['abcde'], imagePushedAt: Date.now() - (100 * DAY), imageSizeInBytes: 1000000000 },
                ],
            });
        });
        sdk.stubEcr({
            batchGetImage: mockBatchGetImage,
            describeImages: mockDescribeImagesFuture,
            batchDeleteImage: mockBatchDeleteImage,
            putImage: mockPutImage,
            listImages: mockListImages,
        });
        garbageCollector = garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        // assets are to be deleted
        expect(mocks.mockBatchDeleteImage).toHaveBeenCalledWith({
            repositoryName: 'REPO_NAME',
            imageIds: [
                { imageDigest: 'digest3' },
            ],
        });
    });
    test('succeeds when no images are present', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        const mockListImagesNone = jest.fn().mockImplementation(() => {
            return Promise.resolve({
                images: [],
            });
        });
        sdk.stubEcr({
            batchGetImage: mockBatchGetImage,
            describeImages: mockDescribeImages,
            batchDeleteImage: mockBatchDeleteImage,
            putImage: mockPutImage,
            listImages: mockListImagesNone,
        });
        garbageCollector = garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 0,
            action: 'full',
        });
        // succeeds without hanging
        await garbageCollector.garbageCollect();
    });
    test('tags are unique', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 'ecr',
            rollbackBufferDays: 3,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        // tags objects
        expect(mocks.mockPutImage).toHaveBeenCalledTimes(2);
        expect(mocks.mockPutImage).toHaveBeenCalledWith({
            repositoryName: 'REPO_NAME',
            imageDigest: 'digest3',
            imageManifest: expect.any(Object),
            imageTag: expect.stringContaining(`0-${api_1.ECR_ISOLATED_TAG}`),
        });
        expect(mocks.mockPutImage).toHaveBeenCalledWith({
            repositoryName: 'REPO_NAME',
            imageDigest: 'digest2',
            imageManifest: expect.any(Object),
            imageTag: expect.stringContaining(`1-${api_1.ECR_ISOLATED_TAG}`),
        });
    });
});
describe('CloudFormation API calls', () => {
    let mocks;
    beforeEach(() => {
        mocks = setupS3GarbageCollectionMocks(sdk);
    });
    test('bootstrap filters out other bootstrap versions', async () => {
        mockTheToolkitInfo({
            Parameters: [{
                    ParameterKey: 'Qualifier',
                    ParameterValue: 'zzzzzz',
                }],
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 3,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockGetTemplateSummary).toHaveBeenCalledTimes(2);
        expect(mocks.mockGetTemplate).toHaveBeenCalledTimes(0);
    });
    test('parameter hashes are included', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        const mockGetTemplateSummaryAssets = jest.fn().mockReturnValue({
            Parameters: [{
                    ParameterKey: 'AssetParametersasset1',
                    DefaultValue: 'asset1',
                }],
        });
        sdk.stubCloudFormation({
            listStacks: mockListStacks,
            getTemplateSummary: mockGetTemplateSummaryAssets,
            getTemplate: mockGetTemplate,
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 0,
            action: 'full',
        });
        await garbageCollector.garbageCollect();
        expect(mocks.mockListStacks).toHaveBeenCalledTimes(1);
        expect(mockListObjectsV2).toHaveBeenCalledTimes(2);
        // no tagging
        expect(mockGetObjectTagging).toHaveBeenCalledTimes(0);
        expect(mockPutObjectTagging).toHaveBeenCalledTimes(0);
        // assets are to be deleted
        expect(mockDeleteObjects).toHaveBeenCalledWith({
            Bucket: 'BUCKET_NAME',
            Delete: {
                Objects: [
                    // no 'asset1'
                    { Key: 'asset2' },
                    { Key: 'asset3' },
                ],
                Quiet: true,
            },
        });
    });
});
let mockListObjectsV2Large;
let mockGetObjectTaggingLarge;
describe('Garbage Collection with large # of objects', () => {
    const keyCount = 10000;
    beforeEach(() => {
        mockListStacks = jest.fn().mockResolvedValue({
            StackSummaries: [
                { StackName: 'Stack1', StackStatus: 'CREATE_COMPLETE' },
            ],
        });
        mockGetTemplateSummary = jest.fn().mockReturnValue({
            Parameters: [{
                    ParameterKey: 'BootstrapVersion',
                    DefaultValue: '/cdk-bootstrap/abcde/version',
                }],
        });
        // add every 5th asset hash to the mock template body: 8000 assets are isolated
        const mockTemplateBody = [];
        for (let i = 0; i < keyCount; i += 5) {
            mockTemplateBody.push(`asset${i}hash`);
        }
        mockGetTemplate = jest.fn().mockReturnValue({
            TemplateBody: mockTemplateBody.join('-'),
        });
        const contents = [];
        for (let i = 0; i < keyCount; i++) {
            contents.push({
                Key: `asset${i}hash`,
                LastModified: new Date(0),
            });
        }
        mockListObjectsV2Large = jest.fn().mockImplementation(() => {
            return Promise.resolve({
                Contents: contents,
                KeyCount: keyCount,
            });
        });
        // every other object has the isolated tag: of the 8000 isolated assets, 4000 already are tagged.
        // of the 2000 in use assets, 1000 are tagged.
        mockGetObjectTaggingLarge = jest.fn().mockImplementation((params) => {
            return Promise.resolve({
                TagSet: Number(params.Key[params.Key.length - 5]) % 2 === 0 ? [{ Key: api_1.S3_ISOLATED_TAG, Value: new Date(2000, 1, 1).toISOString() }] : [],
            });
        });
        mockPutObjectTagging = jest.fn();
        mockDeleteObjects = jest.fn();
        mockDeleteObjectTagging = jest.fn();
        mockDescribeStacks = jest.fn();
        sdk.stubCloudFormation({
            listStacks: mockListStacks,
            getTemplateSummary: mockGetTemplateSummary,
            getTemplate: mockGetTemplate,
            describeStacks: mockDescribeStacks,
        });
        sdk.stubS3({
            listObjectsV2: mockListObjectsV2Large,
            getObjectTagging: mockGetObjectTaggingLarge,
            deleteObjects: mockDeleteObjects,
            deleteObjectTagging: mockDeleteObjectTagging,
            putObjectTagging: mockPutObjectTagging,
        });
    });
    afterEach(() => {
        mockGarbageCollect.mockClear();
    });
    test('tag only', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 1,
            action: 'tag',
        });
        await garbageCollector.garbageCollect();
        expect(mockListStacks).toHaveBeenCalledTimes(1);
        expect(mockListObjectsV2Large).toHaveBeenCalledTimes(2);
        // tagging is performed
        expect(mockGetObjectTaggingLarge).toHaveBeenCalledTimes(keyCount);
        expect(mockDeleteObjectTagging).toHaveBeenCalledTimes(1000); // 1000 in use assets are erroneously tagged
        expect(mockPutObjectTagging).toHaveBeenCalledTimes(5000); // 8000-4000 assets need to be tagged, + 1000 (since untag also calls this)
    });
    test('delete-tagged only', async () => {
        mockTheToolkitInfo({
            Outputs: [
                {
                    OutputKey: 'BootstrapVersion',
                    OutputValue: '999',
                },
            ],
        });
        garbageCollector = garbageCollector = gc({
            type: 's3',
            rollbackBufferDays: 1,
            action: 'delete-tagged',
        });
        await garbageCollector.garbageCollect();
        expect(mockListStacks).toHaveBeenCalledTimes(1);
        expect(mockListObjectsV2Large).toHaveBeenCalledTimes(2);
        // delete previously tagged objects
        expect(mockGetObjectTaggingLarge).toHaveBeenCalledTimes(keyCount);
        expect(mockDeleteObjects).toHaveBeenCalledTimes(4); // 4000 isolated assets are already tagged, deleted in batches of 1000
    });
});
describe('BackgroundStackRefresh', () => {
    let backgroundRefresh;
    let refreshProps;
    let setTimeoutSpy;
    beforeEach(() => {
        jest.useFakeTimers();
        setTimeoutSpy = jest.spyOn(global, 'setTimeout');
        mockListStacks = jest.fn().mockResolvedValue({
            StackSummaries: [
                { StackName: 'Stack1', StackStatus: 'CREATE_COMPLETE' },
                { StackName: 'Stack2', StackStatus: 'UPDATE_COMPLETE' },
            ],
        });
        mockGetTemplateSummary = jest.fn().mockReturnValue({
            Parameters: [{
                    ParameterKey: 'BootstrapVersion',
                    DefaultValue: '/cdk-bootstrap/abcde/version',
                }],
        });
        mockGetTemplate = jest.fn().mockReturnValue({
            TemplateBody: 'abcde',
        });
        sdk.stubCloudFormation({
            listStacks: mockListStacks,
            getTemplateSummary: mockGetTemplateSummary,
            getTemplate: mockGetTemplate,
            describeStacks: jest.fn(),
        });
        refreshProps = {
            cfn: sdk.mockSdk.cloudFormation(),
            activeAssets: new stack_refresh_1.ActiveAssetCache(),
        };
        backgroundRefresh = new stack_refresh_1.BackgroundStackRefresh(refreshProps);
    });
    afterEach(() => {
        jest.clearAllTimers();
        setTimeoutSpy.mockRestore();
    });
    test('should start after a delay', () => {
        void backgroundRefresh.start();
        expect(setTimeoutSpy).toHaveBeenCalledTimes(1);
        expect(setTimeoutSpy).toHaveBeenLastCalledWith(expect.any(Function), 300000);
    });
    test('should refresh stacks and schedule next refresh', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which should trigger the first refresh)
        await jest.runOnlyPendingTimersAsync();
        expect(mockListStacks).toHaveBeenCalledTimes(1);
        expect(setTimeoutSpy).toHaveBeenCalledTimes(2); // Once for start, once for next refresh
        expect(setTimeoutSpy).toHaveBeenLastCalledWith(expect.any(Function), 300000);
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        expect(mockListStacks).toHaveBeenCalledTimes(2);
        expect(setTimeoutSpy).toHaveBeenCalledTimes(3); // Two refreshes plus one more scheduled
    });
    test('should wait for the next refresh if called within time frame', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        const waitPromise = backgroundRefresh.noOlderThan(180000); // 3 minutes
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes
        await expect(waitPromise).resolves.toBeUndefined();
    });
    test('should wait for the next refresh if refresh lands before the timeout', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        jest.advanceTimersByTime(24000); // Advance time by 4 minutes
        const waitPromise = backgroundRefresh.noOlderThan(300000); // 5 minutes
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes, refresh should fire
        await expect(waitPromise).resolves.toBeUndefined();
    });
    test('should reject if the refresh takes too long', async () => {
        void backgroundRefresh.start();
        // Run the first timer (which triggers the first refresh)
        await jest.runOnlyPendingTimersAsync();
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes
        const waitPromise = backgroundRefresh.noOlderThan(0); // 0 seconds
        jest.advanceTimersByTime(120000); // Advance time by 2 minutes
        await expect(waitPromise).rejects.toThrow('refreshStacks took too long; the background thread likely threw an error');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FyYmFnZS1jb2xsZWN0aW9uLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnYXJiYWdlLWNvbGxlY3Rpb24udGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaUNBQWlDOztBQUVqQyxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUVyQyx1Q0FBaUc7QUFDakcsa0ZBQXVJO0FBQ3ZJLCtDQUFnRjtBQUVoRixJQUFJLGdCQUFrQyxDQUFDO0FBQ3ZDLElBQUksY0FBK0csQ0FBQztBQUNwSCxJQUFJLGtCQUEySCxDQUFDO0FBQ2hJLElBQUksc0JBQXVJLENBQUM7QUFDNUksSUFBSSxlQUFrSCxDQUFDO0FBQ3ZILElBQUksaUJBQWtHLENBQUM7QUFDdkcsSUFBSSxvQkFBMkcsQ0FBQztBQUNoSCxJQUFJLGlCQUFrRyxDQUFDO0FBQ3ZHLElBQUksdUJBQW9ILENBQUM7QUFDekgsSUFBSSxvQkFBMkcsQ0FBQztBQUNoSCxJQUFJLG9CQUErRyxDQUFDO0FBQ3BILElBQUksaUJBQXNHLENBQUM7QUFDM0csSUFBSSxZQUF1RixDQUFDO0FBQzVGLElBQUksY0FBNkYsQ0FBQztBQUNsRyxJQUFJLGtCQUF5RyxDQUFDO0FBRTlHLElBQUksVUFBNEIsQ0FBQztBQUNqQyxJQUFJLEdBQW9CLENBQUM7QUFFekIsTUFBTSxHQUFHLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsa0NBQWtDO0FBRW5FLFNBQVMsa0JBQWtCLENBQUMsVUFBNkM7SUFDdkUsTUFBTSxPQUFPLEdBQUcsSUFBSSxrQkFBTyxFQUFFLENBQUM7SUFDN0IsaUJBQW1CLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBVyxDQUFDLFNBQVMsQ0FBQyxJQUFBLDZCQUFrQixFQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFD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LGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFDO1FBRS9CLHlEQUF5RDtRQUN6RCxNQUFNLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLDRCQUE0QjtRQUU5RCxNQUFNLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZO1FBQ2xFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLDRCQUE0QjtRQUU5RCxNQUFNLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBFQUEwRSxDQUFDLENBQUM7SUFDeEgsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9vcmRlciAqL1xuXG5jb25zdCBtb2NrR2FyYmFnZUNvbGxlY3QgPSBqZXN0LmZuKCk7XG5cbmltcG9ydCB7IEdhcmJhZ2VDb2xsZWN0b3IsIFRvb2xraXRJbmZvLCBFQ1JfSVNPTEFURURfVEFHLCBTM19JU09MQVRFRF9UQUcgfSBmcm9tICcuLi8uLi9saWIvYXBpJztcbmltcG9ydCB7IEFjdGl2ZUFzc2V0Q2FjaGUsIEJhY2tncm91bmRTdGFja1JlZnJlc2gsIEJhY2tncm91bmRTdGFja1JlZnJlc2hQcm9wcyB9IGZyb20gJy4uLy4uL2xpYi9hcGkvZ2FyYmFnZS1jb2xsZWN0aW9uL3N0YWNrLXJlZnJlc2gnO1xuaW1wb3J0IHsgbW9ja0Jvb3RzdHJhcFN0YWNrLCBNb2NrU2RrLCBNb2NrU2RrUHJvdmlkZXIgfSBmcm9tICcuLi91dGlsL21vY2stc2RrJztcblxubGV0IGdhcmJhZ2VDb2xsZWN0b3I6IEdhcmJhZ2VDb2xsZWN0b3I7XG5sZXQgbW9ja0xpc3RTdGFja3M6IChwYXJhbXM6IEFXUy5DbG91ZEZvcm1hdGlvbi5UeXBlcy5MaXN0U3RhY2tzSW5wdXQpID0+IEFXUy5DbG91ZEZvcm1hdGlvbi5UeXBlcy5MaXN0U3RhY2tzT3V0cHV0O1xubGV0IG1vY2tEZXNjcmliZVN0YWNrczogKHBhcmFtczogQVdTLkNsb3VkRm9ybWF0aW9uLlR5cGVzLkRlc2NyaWJlU3RhY2tzSW5wdXQpID0+IEFXUy5DbG91ZEZvcm1hdGlvbi5UeXBlcy5EZXNjcmliZVN0YWNrc091dHB1dDtcbmxldCBtb2NrR2V0VGVtcGxhdGVTdW1tYXJ5OiAocGFyYW1zOiBBV1MuQ2xvdWRGb3JtYXRpb24uVHlwZXMuR2V0VGVtcGxhdGVTdW1tYXJ5SW5wdXQpID0+IEFXUy5DbG91ZEZvcm1hdGlvbi5UeXBlcy5HZXRUZW1wbGF0ZVN1bW1hcnlPdXRwdXQ7XG5sZXQgbW9ja0dldFRlbXBsYXRlOiAocGFyYW1zOiBBV1MuQ2xvdWRGb3JtYXRpb24uVHlwZXMuR2V0VGVtcGxhdGVJbnB1dCkgPT4gQVdTLkNsb3VkRm9ybWF0aW9uLlR5cGVzLkdldFRlbXBsYXRlT3V0cHV0O1xubGV0IG1vY2tMaXN0T2JqZWN0c1YyOiAocGFyYW1zOiBBV1MuUzMuVHlwZXMuTGlzdE9iamVjdHNWMlJlcXVlc3QpID0+IEFXUy5TMy5UeXBlcy5MaXN0T2JqZWN0c1YyT3V0cHV0O1xubGV0IG1vY2tHZXRPYmplY3RUYWdnaW5nOiAocGFyYW1zOiBBV1MuUzMuVHlwZXMuR2V0T2JqZWN0VGFnZ2luZ1JlcXVlc3QpID0+IEFXUy5TMy5UeXBlcy5HZXRPYmplY3RUYWdnaW5nT3V0cHV0O1xubGV0IG1vY2tEZWxldGVPYmplY3RzOiAocGFyYW1zOiBBV1MuUzMuVHlwZXMuRGVsZXRlT2JqZWN0c1JlcXVlc3QpID0+IEFXUy5TMy5UeXBlcy5EZWxldGVPYmplY3RzT3V0cHV0O1xubGV0IG1vY2tEZWxldGVPYmplY3RUYWdnaW5nOiAocGFyYW1zOiBBV1MuUzMuVHlwZXMuRGVsZXRlT2JqZWN0VGFnZ2luZ1JlcXVlc3QpID0+IEFXUy5TMy5UeXBlcy5EZWxldGVPYmplY3RUYWdnaW5nT3V0cHV0O1xubGV0IG1vY2tQdXRPYmplY3RUYWdnaW5nOiAocGFyYW1zOiBBV1MuUzMuVHlwZXMuUHV0T2JqZWN0VGFnZ2luZ1JlcXVlc3QpID0+IEFXUy5TMy5UeXBlcy5QdXRPYmplY3RUYWdnaW5nT3V0cHV0O1xubGV0IG1vY2tCYXRjaERlbGV0ZUltYWdlOiAocGFyYW1zOiBBV1MuRUNSLlR5cGVzLkJhdGNoRGVsZXRlSW1hZ2VSZXF1ZXN0KSA9PiBBV1MuRUNSLlR5cGVzLkJhdGNoRGVsZXRlSW1hZ2VSZXNwb25zZTtcbmxldCBtb2NrQmF0Y2hHZXRJbWFnZTogKHBhcmFtczogQVdTLkVDUi5UeXBlcy5CYXRjaEdldEltYWdlUmVxdWVzdCkgPT4gQVdTLkVDUi5UeXBlcy5CYXRjaEdldEltYWdlUmVzcG9uc2U7XG5sZXQgbW9ja1B1dEltYWdlOiAocGFyYW1zOiBBV1MuRUNSLlR5cGVzLlB1dEltYWdlUmVxdWVzdCkgPT4gQVdTLkVDUi5UeXBlcy5QdXRJbWFnZVJlc3BvbnNlO1xubGV0IG1vY2tMaXN0SW1hZ2VzOiAocGFyYW1zOiBBV1MuRUNSLlR5cGVzLkxpc3RJbWFnZXNSZXF1ZXN0KSA9PiBBV1MuRUNSLlR5cGVzLkxpc3RJbWFnZXNSZXNwb25zZTtcbmxldCBtb2NrRGVzY3JpYmVJbWFnZXM6IChwYXJhbXM6IEFXUy5FQ1IuVHlwZXMuRGVzY3JpYmVJbWFnZXNSZXF1ZXN0KSA9PiBBV1MuRUNSLlR5cGVzLkRlc2NyaWJlSW1hZ2VzUmVzcG9uc2U7XG5cbmxldCBzdGRlcnJNb2NrOiBqZXN0LlNweUluc3RhbmNlO1xubGV0IHNkazogTW9ja1Nka1Byb3ZpZGVyO1xuXG5jb25zdCBEQVkgPSAyNCAqIDYwICogNjAgKiAxMDAwOyAvLyBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIGluIGEgZGF5XG5cbmZ1bmN0aW9uIG1vY2tUaGVUb29sa2l0SW5mbyhzdGFja1Byb3BzOiBQYXJ0aWFsPEFXUy5DbG91ZEZvcm1hdGlvbi5TdGFjaz4pIHtcbiAgY29uc3QgbW9ja1NkayA9IG5ldyBNb2NrU2RrKCk7XG4gIChUb29sa2l0SW5mbyBhcyBhbnkpLmxvb2t1cCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShUb29sa2l0SW5mby5mcm9tU3RhY2sobW9ja0Jvb3RzdHJhcFN0YWNrKG1vY2tTZGssIHN0YWNrUHJvcHMpKSk7XG59XG5cbmZ1bmN0aW9uIGdjKHByb3BzOiB7XG4gIHR5cGU6ICdzMycgfCAnZWNyJyB8ICdhbGwnO1xuICByb2xsYmFja0J1ZmZlckRheXM/OiBudW1iZXI7XG4gIGNyZWF0ZWRBdEJ1ZmZlckRheXM/OiBudW1iZXI7XG4gIGFjdGlvbjogJ2Z1bGwnIHwgJ3ByaW50JyB8ICd0YWcnIHwgJ2RlbGV0ZS10YWdnZWQnO1xufSk6IEdhcmJhZ2VDb2xsZWN0b3Ige1xuICByZXR1cm4gbmV3IEdhcmJhZ2VDb2xsZWN0b3Ioe1xuICAgIHNka1Byb3ZpZGVyOiBzZGssXG4gICAgYWN0aW9uOiBwcm9wcy5hY3Rpb24sXG4gICAgcmVzb2x2ZWRFbnZpcm9ubWVudDoge1xuICAgICAgYWNjb3VudDogJzEyMzQ1Njc4OTAxMicsXG4gICAgICByZWdpb246ICd1cy1lYXN0LTEnLFxuICAgICAgbmFtZTogJ21vY2snLFxuICAgIH0sXG4gICAgYm9vdHN0cmFwU3RhY2tOYW1lOiAnR2FyYmFnZVN0YWNrJyxcbiAgICByb2xsYmFja0J1ZmZlckRheXM6IHByb3BzLnJvbGxiYWNrQnVmZmVyRGF5cyA/PyAwLFxuICAgIGNyZWF0ZWRCdWZmZXJEYXlzOiBwcm9wcy5jcmVhdGVkQXRCdWZmZXJEYXlzID8/IDAsXG4gICAgdHlwZTogcHJvcHMudHlwZSxcbiAgICBjb25maXJtOiBmYWxzZSxcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHNldHVwQ0ZOR2FyYmFnZUNvbGxlY3Rpb25Nb2Nrcyhtb2NrU2RrOiBNb2NrU2RrUHJvdmlkZXIpIHtcbiAgbW9ja0xpc3RTdGFja3MgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgIFN0YWNrU3VtbWFyaWVzOiBbXG4gICAgICB7IFN0YWNrTmFtZTogJ1N0YWNrMScsIFN0YWNrU3RhdHVzOiAnQ1JFQVRFX0NPTVBMRVRFJyB9LFxuICAgICAgeyBTdGFja05hbWU6ICdTdGFjazInLCBTdGFja1N0YXR1czogJ1VQREFURV9DT01QTEVURScgfSxcbiAgICBdLFxuICB9KTtcbiAgbW9ja0dldFRlbXBsYXRlU3VtbWFyeSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgIFBhcmFtZXRlcnM6IFt7XG4gICAgICBQYXJhbWV0ZXJLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgIERlZmF1bHRWYWx1ZTogJy9jZGstYm9vdHN0cmFwL2FiY2RlL3ZlcnNpb24nLFxuICAgIH1dLFxuICB9KTtcbiAgbW9ja0dldFRlbXBsYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgVGVtcGxhdGVCb2R5OiAnYWJjZGUnLFxuICB9KTtcbiAgbW9ja0Rlc2NyaWJlU3RhY2tzID0gamVzdC5mbigpO1xuXG4gIG1vY2tTZGsuc3R1YkNsb3VkRm9ybWF0aW9uKHtcbiAgICBsaXN0U3RhY2tzOiBtb2NrTGlzdFN0YWNrcyxcbiAgICBnZXRUZW1wbGF0ZVN1bW1hcnk6IG1vY2tHZXRUZW1wbGF0ZVN1bW1hcnksXG4gICAgZ2V0VGVtcGxhdGU6IG1vY2tHZXRUZW1wbGF0ZSxcbiAgICBkZXNjcmliZVN0YWNrczogbW9ja0Rlc2NyaWJlU3RhY2tzLFxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIG1vY2tMaXN0U3RhY2tzLFxuICAgIG1vY2tHZXRUZW1wbGF0ZVN1bW1hcnksXG4gICAgbW9ja0dldFRlbXBsYXRlLFxuICAgIG1vY2tEZXNjcmliZVN0YWNrcyxcbiAgfTtcbn1cblxuZnVuY3Rpb24gc2V0dXBTM0dhcmJhZ2VDb2xsZWN0aW9uTW9ja3MobW9ja1NkazogTW9ja1Nka1Byb3ZpZGVyKSB7XG4gIGNvbnN0IG1vY2tzID0gc2V0dXBDRk5HYXJiYWdlQ29sbGVjdGlvbk1vY2tzKG1vY2tTZGspO1xuXG4gIG1vY2tMaXN0T2JqZWN0c1YyID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICBDb250ZW50czogW1xuICAgICAgICB7IEtleTogJ2Fzc2V0MScsIExhc3RNb2RpZmllZDogbmV3IERhdGUoRGF0ZS5ub3coKSAtICgyICogREFZKSkgfSxcbiAgICAgICAgeyBLZXk6ICdhc3NldDInLCBMYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAoMTAgKiBEQVkpKSB9LFxuICAgICAgICB7IEtleTogJ2Fzc2V0MycsIExhc3RNb2RpZmllZDogbmV3IERhdGUoRGF0ZS5ub3coKSAtICgxMDAgKiBEQVkpKSB9LFxuICAgICAgXSxcbiAgICAgIEtleUNvdW50OiAzLFxuICAgIH0pO1xuICB9KTtcbiAgbW9ja0dldE9iamVjdFRhZ2dpbmcgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbXMpID0+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgIFRhZ1NldDogcGFyYW1zLktleSA9PT0gJ2Fzc2V0MicgPyBbeyBLZXk6IFMzX0lTT0xBVEVEX1RBRywgVmFsdWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9XSA6IFtdLFxuICAgIH0pO1xuICB9KTtcbiAgbW9ja1B1dE9iamVjdFRhZ2dpbmcgPSBqZXN0LmZuKCk7XG4gIG1vY2tEZWxldGVPYmplY3RzID0gamVzdC5mbigpO1xuICBtb2NrRGVsZXRlT2JqZWN0VGFnZ2luZyA9IGplc3QuZm4oKTtcblxuICBtb2NrU2RrLnN0dWJTMyh7XG4gICAgbGlzdE9iamVjdHNWMjogbW9ja0xpc3RPYmplY3RzVjIsXG4gICAgZ2V0T2JqZWN0VGFnZ2luZzogbW9ja0dldE9iamVjdFRhZ2dpbmcsXG4gICAgZGVsZXRlT2JqZWN0czogbW9ja0RlbGV0ZU9iamVjdHMsXG4gICAgZGVsZXRlT2JqZWN0VGFnZ2luZzogbW9ja0RlbGV0ZU9iamVjdFRhZ2dpbmcsXG4gICAgcHV0T2JqZWN0VGFnZ2luZzogbW9ja1B1dE9iamVjdFRhZ2dpbmcsXG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgLi4ubW9ja3MsXG4gICAgbW9ja0xpc3RPYmplY3RzVjIsXG4gICAgbW9ja0dldE9iamVjdFRhZ2dpbmcsXG4gICAgbW9ja0RlbGV0ZU9iamVjdHMsXG4gICAgbW9ja0RlbGV0ZU9iamVjdFRhZ2dpbmcsXG4gICAgbW9ja1B1dE9iamVjdFRhZ2dpbmcsXG4gIH07XG59XG5cbmZ1bmN0aW9uIHNldHVwRWNyR2FyYmFnZUNvbGxlY3Rpb25Nb2Nrcyhtb2NrU2RrOiBNb2NrU2RrUHJvdmlkZXIpIHtcbiAgY29uc3QgbW9ja3MgPSBzZXR1cENGTkdhcmJhZ2VDb2xsZWN0aW9uTW9ja3MobW9ja1Nkayk7XG4gIG1vY2tCYXRjaEdldEltYWdlID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICBpbWFnZXM6IFtcbiAgICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MScgfSwgaW1hZ2VNYW5pZmVzdDoge30gfSxcbiAgICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MicgfSwgaW1hZ2VNYW5pZmVzdDoge30gfSxcbiAgICAgICAgeyBpbWFnZUlkOiB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MycgfSwgaW1hZ2VNYW5pZmVzdDoge30gfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xuICBtb2NrRGVzY3JpYmVJbWFnZXMgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgIGltYWdlRGV0YWlsczogW1xuICAgICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MycsIGltYWdlVGFnczogWydrbG1ubyddLCBpbWFnZVB1c2hlZEF0OiBEYXRlLm5vdygpIC0gKDIgKiBEQVkpLCBpbWFnZVNpemVJbkJ5dGVzOiAxMDAgfSxcbiAgICAgICAgeyBpbWFnZURpZ2VzdDogJ2RpZ2VzdDInLCBpbWFnZVRhZ3M6IFsnZmdoaWonXSwgaW1hZ2VQdXNoZWRBdDogRGF0ZS5ub3coKSAtICgxMCAqIERBWSksIGltYWdlU2l6ZUluQnl0ZXM6IDMwMF8wMDBfMDAwIH0sXG4gICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QxJywgaW1hZ2VUYWdzOiBbJ2FiY2RlJ10sIGltYWdlUHVzaGVkQXQ6IERhdGUubm93KCkgLSAoMTAwICogREFZKSwgaW1hZ2VTaXplSW5CeXRlczogMV8wMDBfMDAwXzAwMCB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG4gIG1vY2tCYXRjaERlbGV0ZUltYWdlID0gamVzdC5mbigpO1xuICBtb2NrUHV0SW1hZ2UgPSBqZXN0LmZuKCk7XG4gIG1vY2tMaXN0SW1hZ2VzID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICBpbWFnZUlkczogW1xuICAgICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MScsIGltYWdlVGFnOiAnYWJjZGUnIH0sIC8vIGludXNlXG4gICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QyJywgaW1hZ2VUYWc6ICdmZ2hpaicgfSxcbiAgICAgICAgeyBpbWFnZURpZ2VzdDogJ2RpZ2VzdDMnLCBpbWFnZVRhZzogJ2tsbW5vJyB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgbW9ja1Nkay5zdHViRWNyKHtcbiAgICBiYXRjaEdldEltYWdlOiBtb2NrQmF0Y2hHZXRJbWFnZSxcbiAgICBkZXNjcmliZUltYWdlczogbW9ja0Rlc2NyaWJlSW1hZ2VzLFxuICAgIGJhdGNoRGVsZXRlSW1hZ2U6IG1vY2tCYXRjaERlbGV0ZUltYWdlLFxuICAgIHB1dEltYWdlOiBtb2NrUHV0SW1hZ2UsXG4gICAgbGlzdEltYWdlczogbW9ja0xpc3RJbWFnZXMsXG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgLi4ubW9ja3MsXG4gICAgbW9ja0Rlc2NyaWJlSW1hZ2VzLFxuICAgIG1vY2tCYXRjaERlbGV0ZUltYWdlLFxuICAgIG1vY2tQdXRJbWFnZSxcbiAgICBtb2NrTGlzdEltYWdlcyxcbiAgfTtcbn1cblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIHNkayA9IG5ldyBNb2NrU2RrUHJvdmlkZXIoeyByZWFsU2RrOiBmYWxzZSB9KTtcbiAgLy8gQnkgZGVmYXVsdCwgd2UnbGwgcmV0dXJuIGEgbm9uLWZvdW5kIHRvb2xraXQgaW5mb1xuICAoVG9vbGtpdEluZm8gYXMgYW55KS5sb29rdXAgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoVG9vbGtpdEluZm8uYm9vdHN0cmFwU3RhY2tOb3RGb3VuZEluZm8oJ0dhcmJhZ2VTdGFjaycpKTtcbiAgc3RkZXJyTW9jayA9IGplc3Quc3B5T24ocHJvY2Vzcy5zdGRlcnIsICd3cml0ZScpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7IHJldHVybiB0cnVlOyB9KTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICBzdGRlcnJNb2NrLm1vY2tSZXN0b3JlKCk7XG59KTtcblxuZGVzY3JpYmUoJ1MzIEdhcmJhZ2UgQ29sbGVjdGlvbicsICgpID0+IHtcbiAgbGV0IG1vY2tzOiBhbnk7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1vY2tzID0gc2V0dXBTM0dhcmJhZ2VDb2xsZWN0aW9uTW9ja3Moc2RrKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBtb2NrR2FyYmFnZUNvbGxlY3QubW9ja0NsZWFyKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JvbGxiYWNrQnVmZmVyRGF5cyA9IDAgLS0gYXNzZXRzIHRvIGJlIGRlbGV0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdFN0YWNrcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdE9iamVjdHNWMikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIC8vIG5vIHRhZ2dpbmdcbiAgICBleHBlY3QobW9ja3MubW9ja0dldE9iamVjdFRhZ2dpbmcpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgICBleHBlY3QobW9ja3MubW9ja1B1dE9iamVjdFRhZ2dpbmcpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcblxuICAgIC8vIGFzc2V0cyBhcmUgdG8gYmUgZGVsZXRlZFxuICAgIGV4cGVjdChtb2Nrcy5tb2NrRGVsZXRlT2JqZWN0cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgQnVja2V0OiAnQlVDS0VUX05BTUUnLFxuICAgICAgRGVsZXRlOiB7XG4gICAgICAgIE9iamVjdHM6IFtcbiAgICAgICAgICB7IEtleTogJ2Fzc2V0MScgfSxcbiAgICAgICAgICB7IEtleTogJ2Fzc2V0MicgfSxcbiAgICAgICAgICB7IEtleTogJ2Fzc2V0MycgfSxcbiAgICAgICAgXSxcbiAgICAgICAgUXVpZXQ6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdyb2xsYmFja0J1ZmZlckRheXMgPiAwIC0tIGFzc2V0cyB0byBiZSB0YWdnZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMyxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdFN0YWNrcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdE9iamVjdHNWMikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuXG4gICAgLy8gYXNzZXRzIHRhZ2dlZFxuICAgIGV4cGVjdChtb2Nrcy5tb2NrR2V0T2JqZWN0VGFnZ2luZykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0T2JqZWN0VGFnZ2luZykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpOyAvLyBvbmUgYXNzZXQgYWxyZWFkeSBoYXMgdGhlIHRhZ1xuXG4gICAgLy8gbm8gZGVsZXRpbmdcbiAgICBleHBlY3QobW9ja3MubW9ja0RlbGV0ZU9iamVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgfSk7XG5cbiAgdGVzdCgnY3JlYXRlZEF0QnVmZmVyRGF5cyA+IDAnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGNyZWF0ZWRBdEJ1ZmZlckRheXM6IDUsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QobW9ja3MubW9ja0RlbGV0ZU9iamVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgIEJ1Y2tldDogJ0JVQ0tFVF9OQU1FJyxcbiAgICAgIERlbGV0ZToge1xuICAgICAgICBPYmplY3RzOiBbXG4gICAgICAgICAgLy8gYXNzZXQxIG5vdCBkZWxldGVkIGJlY2F1c2UgaXQgaXMgdG9vIHlvdW5nXG4gICAgICAgICAgeyBLZXk6ICdhc3NldDInIH0sXG4gICAgICAgICAgeyBLZXk6ICdhc3NldDMnIH0sXG4gICAgICAgIF0sXG4gICAgICAgIFF1aWV0OiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnYWN0aW9uID0gcHJpbnQgLS0gZG9lcyBub3QgdGFnIG9yIGRlbGV0ZScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMyxcbiAgICAgIGFjdGlvbjogJ3ByaW50JyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QobW9ja3MubW9ja0xpc3RTdGFja3MpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QobW9ja3MubW9ja0xpc3RPYmplY3RzVjIpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcblxuICAgIC8vIGdldCB0YWdzLCBidXQgZG9udCBwdXQgdGFnc1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrR2V0T2JqZWN0VGFnZ2luZykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0T2JqZWN0VGFnZ2luZykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuXG4gICAgLy8gbm8gZGVsZXRpbmdcbiAgICBleHBlY3QobW9ja3MubW9ja0RlbGV0ZU9iamVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWN0aW9uID0gdGFnIC0tIGRvZXMgbm90IGRlbGV0ZScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMyxcbiAgICAgIGFjdGlvbjogJ3RhZycsXG4gICAgfSk7XG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuXG4gICAgZXhwZWN0KG1vY2tzLm1vY2tMaXN0U3RhY2tzKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KG1vY2tzLm1vY2tMaXN0T2JqZWN0c1YyKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG5cbiAgICAvLyB0YWdzIG9iamVjdHNcbiAgICBleHBlY3QobW9ja3MubW9ja0dldE9iamVjdFRhZ2dpbmcpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTtcbiAgICBleHBlY3QobW9ja3MubW9ja1B1dE9iamVjdFRhZ2dpbmcpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTsgLy8gb25lIG9iamVjdCBhbHJlYWR5IGhhcyB0aGUgdGFnXG5cbiAgICAvLyBubyBkZWxldGluZ1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrRGVsZXRlT2JqZWN0cykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuICB9KTtcblxuICB0ZXN0KCdhY3Rpb24gPSBkZWxldGUtdGFnZ2VkIC0tIGRvZXMgbm90IHRhZycsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMyxcbiAgICAgIGFjdGlvbjogJ2RlbGV0ZS10YWdnZWQnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdFN0YWNrcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdE9iamVjdHNWMikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuXG4gICAgLy8gZ2V0IHRhZ3MsIGJ1dCBkb250IHB1dCB0YWdzXG4gICAgZXhwZWN0KG1vY2tzLm1vY2tHZXRPYmplY3RUYWdnaW5nKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XG4gICAgZXhwZWN0KG1vY2tzLm1vY2tQdXRPYmplY3RUYWdnaW5nKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2lnbm9yZSBvYmplY3RzIHRoYXQgYXJlIG1vZGlmaWVkIGFmdGVyIGdjIHN0YXJ0JywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9ja0xpc3RPYmplY3RzVjJGdXR1cmUgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICBDb250ZW50czogW1xuICAgICAgICAgIHsgS2V5OiAnYXNzZXQxJywgTGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgwKSB9LFxuICAgICAgICAgIHsgS2V5OiAnYXNzZXQyJywgTGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgwKSB9LFxuICAgICAgICAgIHsgS2V5OiAnYXNzZXQzJywgTGFzdE1vZGlmaWVkOiBuZXcgRGF0ZShuZXcgRGF0ZSgpLnNldEZ1bGxZZWFyKG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSArIDEpKSB9LCAvLyBmdXR1cmUgZGF0ZSBpZ25vcmVkIGV2ZXJ5d2hlcmVcbiAgICAgICAgXSxcbiAgICAgICAgS2V5Q291bnQ6IDMsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHNkay5zdHViUzMoe1xuICAgICAgbGlzdE9iamVjdHNWMjogbW9ja0xpc3RPYmplY3RzVjJGdXR1cmUsXG4gICAgICBnZXRPYmplY3RUYWdnaW5nOiBtb2NrR2V0T2JqZWN0VGFnZ2luZyxcbiAgICAgIGRlbGV0ZU9iamVjdHM6IG1vY2tEZWxldGVPYmplY3RzLFxuICAgICAgcHV0T2JqZWN0VGFnZ2luZzogbW9ja1B1dE9iamVjdFRhZ2dpbmcsXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDAsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICAvLyBhc3NldHMgYXJlIHRvIGJlIGRlbGV0ZWRcbiAgICBleHBlY3QobW9ja3MubW9ja0RlbGV0ZU9iamVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgIEJ1Y2tldDogJ0JVQ0tFVF9OQU1FJyxcbiAgICAgIERlbGV0ZToge1xuICAgICAgICBPYmplY3RzOiBbXG4gICAgICAgICAgeyBLZXk6ICdhc3NldDEnIH0sXG4gICAgICAgICAgeyBLZXk6ICdhc3NldDInIH0sXG4gICAgICAgICAgLy8gbm8gYXNzZXQzXG4gICAgICAgIF0sXG4gICAgICAgIFF1aWV0OiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0VDUiBHYXJiYWdlIENvbGxlY3Rpb24nLCAoKSA9PiB7XG4gIGxldCBtb2NrczogYW55O1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrcyA9IHNldHVwRWNyR2FyYmFnZUNvbGxlY3Rpb25Nb2NrcyhzZGspO1xuICB9KTtcblxuICB0ZXN0KCdyb2xsYmFja0J1ZmZlckRheXMgPSAwIC0tIGFzc2V0cyB0byBiZSBkZWxldGVkJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAwLFxuICAgICAgYWN0aW9uOiAnZnVsbCcsXG4gICAgfSk7XG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuXG4gICAgZXhwZWN0KG1vY2tzLm1vY2tEZXNjcmliZUltYWdlcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdEltYWdlcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuXG4gICAgLy8gbm8gdGFnZ2luZ1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0SW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcblxuICAgIC8vIGFzc2V0cyBhcmUgdG8gYmUgZGVsZXRlZFxuICAgIGV4cGVjdChtb2Nrcy5tb2NrQmF0Y2hEZWxldGVJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgcmVwb3NpdG9yeU5hbWU6ICdSRVBPX05BTUUnLFxuICAgICAgaW1hZ2VJZHM6IFtcbiAgICAgICAgeyBpbWFnZURpZ2VzdDogJ2RpZ2VzdDMnIH0sXG4gICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QyJyB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgncm9sbGJhY2tCdWZmZXJEYXlzID4gMCAtLSBhc3NldHMgdG8gYmUgdGFnZ2VkJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAzLFxuICAgICAgYWN0aW9uOiAnZnVsbCcsXG4gICAgfSk7XG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuXG4gICAgLy8gYXNzZXRzIHRhZ2dlZFxuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0SW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcblxuICAgIC8vIG5vIGRlbGV0aW5nXG4gICAgZXhwZWN0KG1vY2tzLm1vY2tCYXRjaERlbGV0ZUltYWdlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NyZWF0ZWRBdEJ1ZmZlckRheXMgPiAwJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAwLFxuICAgICAgY3JlYXRlZEF0QnVmZmVyRGF5czogNSxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrQmF0Y2hEZWxldGVJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgcmVwb3NpdG9yeU5hbWU6ICdSRVBPX05BTUUnLFxuICAgICAgaW1hZ2VJZHM6IFtcbiAgICAgICAgLy8gZGlnZXN0MyBpcyB0b28geW91bmcgdG8gYmUgZGVsZXRlZFxuICAgICAgICB7IGltYWdlRGlnZXN0OiAnZGlnZXN0MicgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FjdGlvbiA9IHByaW50IC0tIGRvZXMgbm90IHRhZyBvciBkZWxldGUnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAzLFxuICAgICAgYWN0aW9uOiAncHJpbnQnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdFN0YWNrcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuXG4gICAgLy8gZG9udCBwdXQgdGFnc1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0SW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcblxuICAgIC8vIG5vIGRlbGV0aW5nXG4gICAgZXhwZWN0KG1vY2tzLm1vY2tCYXRjaERlbGV0ZUltYWdlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FjdGlvbiA9IHRhZyAtLSBkb2VzIG5vdCBkZWxldGUnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAzLFxuICAgICAgYWN0aW9uOiAndGFnJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QobW9ja3MubW9ja0xpc3RTdGFja3MpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcblxuICAgIC8vIHRhZ3Mgb2JqZWN0c1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0SW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcblxuICAgIC8vIG5vIGRlbGV0aW5nXG4gICAgZXhwZWN0KG1vY2tzLm1vY2tCYXRjaERlbGV0ZUltYWdlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FjdGlvbiA9IGRlbGV0ZS10YWdnZWQgLS0gZG9lcyBub3QgdGFnJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBPdXRwdXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBPdXRwdXRLZXk6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICBPdXRwdXRWYWx1ZTogJzk5OScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgZ2FyYmFnZUNvbGxlY3RvciA9IGdhcmJhZ2VDb2xsZWN0b3IgPSBnYyh7XG4gICAgICB0eXBlOiAnZWNyJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMyxcbiAgICAgIGFjdGlvbjogJ2RlbGV0ZS10YWdnZWQnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdFN0YWNrcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuXG4gICAgLy8gZG9udCBwdXQgdGFnc1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0SW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgfSk7XG5cbiAgdGVzdCgnaWdub3JlIGltYWdlcyB0aGF0IGFyZSBtb2RpZmllZCBhZnRlciBnYyBzdGFydCcsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IG1vY2tEZXNjcmliZUltYWdlc0Z1dHVyZSA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgIGltYWdlRGV0YWlsczogW1xuICAgICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QzJywgaW1hZ2VUYWdzOiBbJ2tsbW5vJ10sIGltYWdlUHVzaGVkQXQ6IERhdGUubm93KCkgLSAoMiAqIERBWSksIGltYWdlU2l6ZUluQnl0ZXM6IDEwMCB9LFxuICAgICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QyJywgaW1hZ2VUYWdzOiBbJ2ZnaGlqJ10sIGltYWdlUHVzaGVkQXQ6IE51bWJlcihuZXcgRGF0ZSgpLnNldEZ1bGxZZWFyKG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSArIDEpLnRvU3RyaW5nKCkpLCBpbWFnZVNpemVJbkJ5dGVzOiAzMDBfMDAwXzAwMCB9LFxuICAgICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QxJywgaW1hZ2VUYWdzOiBbJ2FiY2RlJ10sIGltYWdlUHVzaGVkQXQ6IERhdGUubm93KCkgLSAoMTAwICogREFZKSwgaW1hZ2VTaXplSW5CeXRlczogMV8wMDBfMDAwXzAwMCB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBzZGsuc3R1YkVjcih7XG4gICAgICBiYXRjaEdldEltYWdlOiBtb2NrQmF0Y2hHZXRJbWFnZSxcbiAgICAgIGRlc2NyaWJlSW1hZ2VzOiBtb2NrRGVzY3JpYmVJbWFnZXNGdXR1cmUsXG4gICAgICBiYXRjaERlbGV0ZUltYWdlOiBtb2NrQmF0Y2hEZWxldGVJbWFnZSxcbiAgICAgIHB1dEltYWdlOiBtb2NrUHV0SW1hZ2UsXG4gICAgICBsaXN0SW1hZ2VzOiBtb2NrTGlzdEltYWdlcyxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ2VjcicsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDAsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICAvLyBhc3NldHMgYXJlIHRvIGJlIGRlbGV0ZWRcbiAgICBleHBlY3QobW9ja3MubW9ja0JhdGNoRGVsZXRlSW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiAnUkVQT19OQU1FJyxcbiAgICAgIGltYWdlSWRzOiBbXG4gICAgICAgIHsgaW1hZ2VEaWdlc3Q6ICdkaWdlc3QzJyB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnc3VjY2VlZHMgd2hlbiBubyBpbWFnZXMgYXJlIHByZXNlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBtb2NrTGlzdEltYWdlc05vbmUgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICBpbWFnZXM6IFtdLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBzZGsuc3R1YkVjcih7XG4gICAgICBiYXRjaEdldEltYWdlOiBtb2NrQmF0Y2hHZXRJbWFnZSxcbiAgICAgIGRlc2NyaWJlSW1hZ2VzOiBtb2NrRGVzY3JpYmVJbWFnZXMsXG4gICAgICBiYXRjaERlbGV0ZUltYWdlOiBtb2NrQmF0Y2hEZWxldGVJbWFnZSxcbiAgICAgIHB1dEltYWdlOiBtb2NrUHV0SW1hZ2UsXG4gICAgICBsaXN0SW1hZ2VzOiBtb2NrTGlzdEltYWdlc05vbmUsXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdlY3InLFxuICAgICAgcm9sbGJhY2tCdWZmZXJEYXlzOiAwLFxuICAgICAgYWN0aW9uOiAnZnVsbCcsXG4gICAgfSk7XG5cbiAgICAvLyBzdWNjZWVkcyB3aXRob3V0IGhhbmdpbmdcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3RhZ3MgYXJlIHVuaXF1ZScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ2VjcicsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICd0YWcnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdFN0YWNrcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuXG4gICAgLy8gdGFncyBvYmplY3RzXG4gICAgZXhwZWN0KG1vY2tzLm1vY2tQdXRJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0SW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiAnUkVQT19OQU1FJyxcbiAgICAgIGltYWdlRGlnZXN0OiAnZGlnZXN0MycsXG4gICAgICBpbWFnZU1hbmlmZXN0OiBleHBlY3QuYW55KE9iamVjdCksXG4gICAgICBpbWFnZVRhZzogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoYDAtJHtFQ1JfSVNPTEFURURfVEFHfWApLFxuICAgIH0pO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrUHV0SW1hZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiAnUkVQT19OQU1FJyxcbiAgICAgIGltYWdlRGlnZXN0OiAnZGlnZXN0MicsXG4gICAgICBpbWFnZU1hbmlmZXN0OiBleHBlY3QuYW55KE9iamVjdCksXG4gICAgICBpbWFnZVRhZzogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoYDEtJHtFQ1JfSVNPTEFURURfVEFHfWApLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnQ2xvdWRGb3JtYXRpb24gQVBJIGNhbGxzJywgKCkgPT4ge1xuICBsZXQgbW9ja3M6IGFueTtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja3MgPSBzZXR1cFMzR2FyYmFnZUNvbGxlY3Rpb25Nb2NrcyhzZGspO1xuICB9KTtcblxuICB0ZXN0KCdib290c3RyYXAgZmlsdGVycyBvdXQgb3RoZXIgYm9vdHN0cmFwIHZlcnNpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vY2tUaGVUb29sa2l0SW5mbyh7XG4gICAgICBQYXJhbWV0ZXJzOiBbe1xuICAgICAgICBQYXJhbWV0ZXJLZXk6ICdRdWFsaWZpZXInLFxuICAgICAgICBQYXJhbWV0ZXJWYWx1ZTogJ3p6enp6eicsXG4gICAgICB9XSxcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDMsXG4gICAgICBhY3Rpb246ICdmdWxsJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QobW9ja3MubW9ja0dldFRlbXBsYXRlU3VtbWFyeSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIGV4cGVjdChtb2Nrcy5tb2NrR2V0VGVtcGxhdGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgfSk7XG5cbiAgdGVzdCgncGFyYW1ldGVyIGhhc2hlcyBhcmUgaW5jbHVkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBtb2NrR2V0VGVtcGxhdGVTdW1tYXJ5QXNzZXRzID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBQYXJhbWV0ZXJzOiBbe1xuICAgICAgICBQYXJhbWV0ZXJLZXk6ICdBc3NldFBhcmFtZXRlcnNhc3NldDEnLFxuICAgICAgICBEZWZhdWx0VmFsdWU6ICdhc3NldDEnLFxuICAgICAgfV0sXG4gICAgfSk7XG5cbiAgICBzZGsuc3R1YkNsb3VkRm9ybWF0aW9uKHtcbiAgICAgIGxpc3RTdGFja3M6IG1vY2tMaXN0U3RhY2tzLFxuICAgICAgZ2V0VGVtcGxhdGVTdW1tYXJ5OiBtb2NrR2V0VGVtcGxhdGVTdW1tYXJ5QXNzZXRzLFxuICAgICAgZ2V0VGVtcGxhdGU6IG1vY2tHZXRUZW1wbGF0ZSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMCxcbiAgICAgIGFjdGlvbjogJ2Z1bGwnLFxuICAgIH0pO1xuICAgIGF3YWl0IGdhcmJhZ2VDb2xsZWN0b3IuZ2FyYmFnZUNvbGxlY3QoKTtcblxuICAgIGV4cGVjdChtb2Nrcy5tb2NrTGlzdFN0YWNrcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChtb2NrTGlzdE9iamVjdHNWMikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIC8vIG5vIHRhZ2dpbmdcbiAgICBleHBlY3QobW9ja0dldE9iamVjdFRhZ2dpbmcpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgICBleHBlY3QobW9ja1B1dE9iamVjdFRhZ2dpbmcpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcblxuICAgIC8vIGFzc2V0cyBhcmUgdG8gYmUgZGVsZXRlZFxuICAgIGV4cGVjdChtb2NrRGVsZXRlT2JqZWN0cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgQnVja2V0OiAnQlVDS0VUX05BTUUnLFxuICAgICAgRGVsZXRlOiB7XG4gICAgICAgIE9iamVjdHM6IFtcbiAgICAgICAgICAvLyBubyAnYXNzZXQxJ1xuICAgICAgICAgIHsgS2V5OiAnYXNzZXQyJyB9LFxuICAgICAgICAgIHsgS2V5OiAnYXNzZXQzJyB9LFxuICAgICAgICBdLFxuICAgICAgICBRdWlldDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmxldCBtb2NrTGlzdE9iamVjdHNWMkxhcmdlOiAocGFyYW1zOiBBV1MuUzMuVHlwZXMuTGlzdE9iamVjdHNWMlJlcXVlc3QpID0+IEFXUy5TMy5UeXBlcy5MaXN0T2JqZWN0c1YyT3V0cHV0O1xubGV0IG1vY2tHZXRPYmplY3RUYWdnaW5nTGFyZ2U6IChwYXJhbXM6IEFXUy5TMy5UeXBlcy5HZXRPYmplY3RUYWdnaW5nUmVxdWVzdCkgPT4gQVdTLlMzLlR5cGVzLkdldE9iamVjdFRhZ2dpbmdPdXRwdXQ7XG5kZXNjcmliZSgnR2FyYmFnZSBDb2xsZWN0aW9uIHdpdGggbGFyZ2UgIyBvZiBvYmplY3RzJywgKCkgPT4ge1xuICBjb25zdCBrZXlDb3VudCA9IDEwMDAwO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1vY2tMaXN0U3RhY2tzID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIFN0YWNrU3VtbWFyaWVzOiBbXG4gICAgICAgIHsgU3RhY2tOYW1lOiAnU3RhY2sxJywgU3RhY2tTdGF0dXM6ICdDUkVBVEVfQ09NUExFVEUnIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICAgIG1vY2tHZXRUZW1wbGF0ZVN1bW1hcnkgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIFBhcmFtZXRlcnM6IFt7XG4gICAgICAgIFBhcmFtZXRlcktleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICBEZWZhdWx0VmFsdWU6ICcvY2RrLWJvb3RzdHJhcC9hYmNkZS92ZXJzaW9uJyxcbiAgICAgIH1dLFxuICAgIH0pO1xuICAgIC8vIGFkZCBldmVyeSA1dGggYXNzZXQgaGFzaCB0byB0aGUgbW9jayB0ZW1wbGF0ZSBib2R5OiA4MDAwIGFzc2V0cyBhcmUgaXNvbGF0ZWRcbiAgICBjb25zdCBtb2NrVGVtcGxhdGVCb2R5ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlDb3VudDsgaSs9NSkge1xuICAgICAgbW9ja1RlbXBsYXRlQm9keS5wdXNoKGBhc3NldCR7aX1oYXNoYCk7XG4gICAgfVxuICAgIG1vY2tHZXRUZW1wbGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgVGVtcGxhdGVCb2R5OiBtb2NrVGVtcGxhdGVCb2R5LmpvaW4oJy0nKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbnRlbnRzOiB7IEtleTogc3RyaW5nOyBMYXN0TW9kaWZpZWQ6IERhdGUgfVtdID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlDb3VudDsgaSsrKSB7XG4gICAgICBjb250ZW50cy5wdXNoKHtcbiAgICAgICAgS2V5OiBgYXNzZXQke2l9aGFzaGAsXG4gICAgICAgIExhc3RNb2RpZmllZDogbmV3IERhdGUoMCksXG4gICAgICB9KTtcbiAgICB9XG4gICAgbW9ja0xpc3RPYmplY3RzVjJMYXJnZSA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgIENvbnRlbnRzOiBjb250ZW50cyxcbiAgICAgICAgS2V5Q291bnQ6IGtleUNvdW50LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBldmVyeSBvdGhlciBvYmplY3QgaGFzIHRoZSBpc29sYXRlZCB0YWc6IG9mIHRoZSA4MDAwIGlzb2xhdGVkIGFzc2V0cywgNDAwMCBhbHJlYWR5IGFyZSB0YWdnZWQuXG4gICAgLy8gb2YgdGhlIDIwMDAgaW4gdXNlIGFzc2V0cywgMTAwMCBhcmUgdGFnZ2VkLlxuICAgIG1vY2tHZXRPYmplY3RUYWdnaW5nTGFyZ2UgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbXMpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICBUYWdTZXQ6IE51bWJlcihwYXJhbXMuS2V5W3BhcmFtcy5LZXkubGVuZ3RoIC0gNV0pICUgMiA9PT0gMCA/IFt7IEtleTogUzNfSVNPTEFURURfVEFHLCBWYWx1ZTogbmV3IERhdGUoMjAwMCwgMSwgMSkudG9JU09TdHJpbmcoKSB9XSA6IFtdLFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgbW9ja1B1dE9iamVjdFRhZ2dpbmcgPSBqZXN0LmZuKCk7XG4gICAgbW9ja0RlbGV0ZU9iamVjdHMgPSBqZXN0LmZuKCk7XG4gICAgbW9ja0RlbGV0ZU9iamVjdFRhZ2dpbmcgPSBqZXN0LmZuKCk7XG4gICAgbW9ja0Rlc2NyaWJlU3RhY2tzID0gamVzdC5mbigpO1xuXG4gICAgc2RrLnN0dWJDbG91ZEZvcm1hdGlvbih7XG4gICAgICBsaXN0U3RhY2tzOiBtb2NrTGlzdFN0YWNrcyxcbiAgICAgIGdldFRlbXBsYXRlU3VtbWFyeTogbW9ja0dldFRlbXBsYXRlU3VtbWFyeSxcbiAgICAgIGdldFRlbXBsYXRlOiBtb2NrR2V0VGVtcGxhdGUsXG4gICAgICBkZXNjcmliZVN0YWNrczogbW9ja0Rlc2NyaWJlU3RhY2tzLFxuICAgIH0pO1xuICAgIHNkay5zdHViUzMoe1xuICAgICAgbGlzdE9iamVjdHNWMjogbW9ja0xpc3RPYmplY3RzVjJMYXJnZSxcbiAgICAgIGdldE9iamVjdFRhZ2dpbmc6IG1vY2tHZXRPYmplY3RUYWdnaW5nTGFyZ2UsXG4gICAgICBkZWxldGVPYmplY3RzOiBtb2NrRGVsZXRlT2JqZWN0cyxcbiAgICAgIGRlbGV0ZU9iamVjdFRhZ2dpbmc6IG1vY2tEZWxldGVPYmplY3RUYWdnaW5nLFxuICAgICAgcHV0T2JqZWN0VGFnZ2luZzogbW9ja1B1dE9iamVjdFRhZ2dpbmcsXG4gICAgfSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgbW9ja0dhcmJhZ2VDb2xsZWN0Lm1vY2tDbGVhcigpO1xuICB9KTtcblxuICB0ZXN0KCd0YWcgb25seScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrVGhlVG9vbGtpdEluZm8oe1xuICAgICAgT3V0cHV0czogW1xuICAgICAgICB7XG4gICAgICAgICAgT3V0cHV0S2V5OiAnQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgT3V0cHV0VmFsdWU6ICc5OTknLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGdhcmJhZ2VDb2xsZWN0b3IgPSBnYXJiYWdlQ29sbGVjdG9yID0gZ2Moe1xuICAgICAgdHlwZTogJ3MzJyxcbiAgICAgIHJvbGxiYWNrQnVmZmVyRGF5czogMSxcbiAgICAgIGFjdGlvbjogJ3RhZycsXG4gICAgfSk7XG4gICAgYXdhaXQgZ2FyYmFnZUNvbGxlY3Rvci5nYXJiYWdlQ29sbGVjdCgpO1xuXG4gICAgZXhwZWN0KG1vY2tMaXN0U3RhY2tzKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KG1vY2tMaXN0T2JqZWN0c1YyTGFyZ2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcblxuICAgIC8vIHRhZ2dpbmcgaXMgcGVyZm9ybWVkXG4gICAgZXhwZWN0KG1vY2tHZXRPYmplY3RUYWdnaW5nTGFyZ2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcyhrZXlDb3VudCk7XG4gICAgZXhwZWN0KG1vY2tEZWxldGVPYmplY3RUYWdnaW5nKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMTAwMCk7IC8vIDEwMDAgaW4gdXNlIGFzc2V0cyBhcmUgZXJyb25lb3VzbHkgdGFnZ2VkXG4gICAgZXhwZWN0KG1vY2tQdXRPYmplY3RUYWdnaW5nKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoNTAwMCk7IC8vIDgwMDAtNDAwMCBhc3NldHMgbmVlZCB0byBiZSB0YWdnZWQsICsgMTAwMCAoc2luY2UgdW50YWcgYWxzbyBjYWxscyB0aGlzKVxuICB9KTtcblxuICB0ZXN0KCdkZWxldGUtdGFnZ2VkIG9ubHknLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja1RoZVRvb2xraXRJbmZvKHtcbiAgICAgIE91dHB1dHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIE91dHB1dEtleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICAgIE91dHB1dFZhbHVlOiAnOTk5JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBnYXJiYWdlQ29sbGVjdG9yID0gZ2FyYmFnZUNvbGxlY3RvciA9IGdjKHtcbiAgICAgIHR5cGU6ICdzMycsXG4gICAgICByb2xsYmFja0J1ZmZlckRheXM6IDEsXG4gICAgICBhY3Rpb246ICdkZWxldGUtdGFnZ2VkJyxcbiAgICB9KTtcbiAgICBhd2FpdCBnYXJiYWdlQ29sbGVjdG9yLmdhcmJhZ2VDb2xsZWN0KCk7XG5cbiAgICBleHBlY3QobW9ja0xpc3RTdGFja3MpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QobW9ja0xpc3RPYmplY3RzVjJMYXJnZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuXG4gICAgLy8gZGVsZXRlIHByZXZpb3VzbHkgdGFnZ2VkIG9iamVjdHNcbiAgICBleHBlY3QobW9ja0dldE9iamVjdFRhZ2dpbmdMYXJnZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKGtleUNvdW50KTtcbiAgICBleHBlY3QobW9ja0RlbGV0ZU9iamVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcyg0KTsgLy8gNDAwMCBpc29sYXRlZCBhc3NldHMgYXJlIGFscmVhZHkgdGFnZ2VkLCBkZWxldGVkIGluIGJhdGNoZXMgb2YgMTAwMFxuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnQmFja2dyb3VuZFN0YWNrUmVmcmVzaCcsICgpID0+IHtcbiAgbGV0IGJhY2tncm91bmRSZWZyZXNoOiBCYWNrZ3JvdW5kU3RhY2tSZWZyZXNoO1xuICBsZXQgcmVmcmVzaFByb3BzOiBCYWNrZ3JvdW5kU3RhY2tSZWZyZXNoUHJvcHM7XG4gIGxldCBzZXRUaW1lb3V0U3B5OiBqZXN0LlNweUluc3RhbmNlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xuICAgIHNldFRpbWVvdXRTcHkgPSBqZXN0LnNweU9uKGdsb2JhbCwgJ3NldFRpbWVvdXQnKTtcblxuICAgIG1vY2tMaXN0U3RhY2tzID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIFN0YWNrU3VtbWFyaWVzOiBbXG4gICAgICAgIHsgU3RhY2tOYW1lOiAnU3RhY2sxJywgU3RhY2tTdGF0dXM6ICdDUkVBVEVfQ09NUExFVEUnIH0sXG4gICAgICAgIHsgU3RhY2tOYW1lOiAnU3RhY2syJywgU3RhY2tTdGF0dXM6ICdVUERBVEVfQ09NUExFVEUnIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICAgIG1vY2tHZXRUZW1wbGF0ZVN1bW1hcnkgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIFBhcmFtZXRlcnM6IFt7XG4gICAgICAgIFBhcmFtZXRlcktleTogJ0Jvb3RzdHJhcFZlcnNpb24nLFxuICAgICAgICBEZWZhdWx0VmFsdWU6ICcvY2RrLWJvb3RzdHJhcC9hYmNkZS92ZXJzaW9uJyxcbiAgICAgIH1dLFxuICAgIH0pO1xuICAgIG1vY2tHZXRUZW1wbGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgVGVtcGxhdGVCb2R5OiAnYWJjZGUnLFxuICAgIH0pO1xuXG4gICAgc2RrLnN0dWJDbG91ZEZvcm1hdGlvbih7XG4gICAgICBsaXN0U3RhY2tzOiBtb2NrTGlzdFN0YWNrcyxcbiAgICAgIGdldFRlbXBsYXRlU3VtbWFyeTogbW9ja0dldFRlbXBsYXRlU3VtbWFyeSxcbiAgICAgIGdldFRlbXBsYXRlOiBtb2NrR2V0VGVtcGxhdGUsXG4gICAgICBkZXNjcmliZVN0YWNrczogamVzdC5mbigpLFxuICAgIH0pO1xuXG4gICAgcmVmcmVzaFByb3BzID0ge1xuICAgICAgY2ZuOiBzZGsubW9ja1Nkay5jbG91ZEZvcm1hdGlvbigpLFxuICAgICAgYWN0aXZlQXNzZXRzOiBuZXcgQWN0aXZlQXNzZXRDYWNoZSgpLFxuICAgIH07XG5cbiAgICBiYWNrZ3JvdW5kUmVmcmVzaCA9IG5ldyBCYWNrZ3JvdW5kU3RhY2tSZWZyZXNoKHJlZnJlc2hQcm9wcyk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICAgIHNldFRpbWVvdXRTcHkubW9ja1Jlc3RvcmUoKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHN0YXJ0IGFmdGVyIGEgZGVsYXknLCAoKSA9PiB7XG4gICAgdm9pZCBiYWNrZ3JvdW5kUmVmcmVzaC5zdGFydCgpO1xuICAgIGV4cGVjdChzZXRUaW1lb3V0U3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KHNldFRpbWVvdXRTcHkpLnRvSGF2ZUJlZW5MYXN0Q2FsbGVkV2l0aChleHBlY3QuYW55KEZ1bmN0aW9uKSwgMzAwMDAwKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHJlZnJlc2ggc3RhY2tzIGFuZCBzY2hlZHVsZSBuZXh0IHJlZnJlc2gnLCBhc3luYyAoKSA9PiB7XG4gICAgdm9pZCBiYWNrZ3JvdW5kUmVmcmVzaC5zdGFydCgpO1xuXG4gICAgLy8gUnVuIHRoZSBmaXJzdCB0aW1lciAod2hpY2ggc2hvdWxkIHRyaWdnZXIgdGhlIGZpcnN0IHJlZnJlc2gpXG4gICAgYXdhaXQgamVzdC5ydW5Pbmx5UGVuZGluZ1RpbWVyc0FzeW5jKCk7XG5cbiAgICBleHBlY3QobW9ja0xpc3RTdGFja3MpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3Qoc2V0VGltZW91dFNweSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpOyAvLyBPbmNlIGZvciBzdGFydCwgb25jZSBmb3IgbmV4dCByZWZyZXNoXG4gICAgZXhwZWN0KHNldFRpbWVvdXRTcHkpLnRvSGF2ZUJlZW5MYXN0Q2FsbGVkV2l0aChleHBlY3QuYW55KEZ1bmN0aW9uKSwgMzAwMDAwKTtcblxuICAgIC8vIFJ1biB0aGUgZmlyc3QgdGltZXIgKHdoaWNoIHRyaWdnZXJzIHRoZSBmaXJzdCByZWZyZXNoKVxuICAgIGF3YWl0IGplc3QucnVuT25seVBlbmRpbmdUaW1lcnNBc3luYygpO1xuXG4gICAgZXhwZWN0KG1vY2tMaXN0U3RhY2tzKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgZXhwZWN0KHNldFRpbWVvdXRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTsgLy8gVHdvIHJlZnJlc2hlcyBwbHVzIG9uZSBtb3JlIHNjaGVkdWxlZFxuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgd2FpdCBmb3IgdGhlIG5leHQgcmVmcmVzaCBpZiBjYWxsZWQgd2l0aGluIHRpbWUgZnJhbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgdm9pZCBiYWNrZ3JvdW5kUmVmcmVzaC5zdGFydCgpO1xuXG4gICAgLy8gUnVuIHRoZSBmaXJzdCB0aW1lciAod2hpY2ggdHJpZ2dlcnMgdGhlIGZpcnN0IHJlZnJlc2gpXG4gICAgYXdhaXQgamVzdC5ydW5Pbmx5UGVuZGluZ1RpbWVyc0FzeW5jKCk7XG5cbiAgICBjb25zdCB3YWl0UHJvbWlzZSA9IGJhY2tncm91bmRSZWZyZXNoLm5vT2xkZXJUaGFuKDE4MDAwMCk7IC8vIDMgbWludXRlc1xuICAgIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSgxMjAwMDApOyAvLyBBZHZhbmNlIHRpbWUgYnkgMiBtaW51dGVzXG5cbiAgICBhd2FpdCBleHBlY3Qod2FpdFByb21pc2UpLnJlc29sdmVzLnRvQmVVbmRlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHdhaXQgZm9yIHRoZSBuZXh0IHJlZnJlc2ggaWYgcmVmcmVzaCBsYW5kcyBiZWZvcmUgdGhlIHRpbWVvdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgdm9pZCBiYWNrZ3JvdW5kUmVmcmVzaC5zdGFydCgpO1xuXG4gICAgLy8gUnVuIHRoZSBmaXJzdCB0aW1lciAod2hpY2ggdHJpZ2dlcnMgdGhlIGZpcnN0IHJlZnJlc2gpXG4gICAgYXdhaXQgamVzdC5ydW5Pbmx5UGVuZGluZ1RpbWVyc0FzeW5jKCk7XG4gICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDI0MDAwKTsgLy8gQWR2YW5jZSB0aW1lIGJ5IDQgbWludXRlc1xuXG4gICAgY29uc3Qgd2FpdFByb21pc2UgPSBiYWNrZ3JvdW5kUmVmcmVzaC5ub09sZGVyVGhhbigzMDAwMDApOyAvLyA1IG1pbnV0ZXNcbiAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMTIwMDAwKTsgLy8gQWR2YW5jZSB0aW1lIGJ5IDIgbWludXRlcywgcmVmcmVzaCBzaG91bGQgZmlyZVxuXG4gICAgYXdhaXQgZXhwZWN0KHdhaXRQcm9taXNlKS5yZXNvbHZlcy50b0JlVW5kZWZpbmVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCByZWplY3QgaWYgdGhlIHJlZnJlc2ggdGFrZXMgdG9vIGxvbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgdm9pZCBiYWNrZ3JvdW5kUmVmcmVzaC5zdGFydCgpO1xuXG4gICAgLy8gUnVuIHRoZSBmaXJzdCB0aW1lciAod2hpY2ggdHJpZ2dlcnMgdGhlIGZpcnN0IHJlZnJlc2gpXG4gICAgYXdhaXQgamVzdC5ydW5Pbmx5UGVuZGluZ1RpbWVyc0FzeW5jKCk7XG4gICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDEyMDAwMCk7IC8vIEFkdmFuY2UgdGltZSBieSAyIG1pbnV0ZXNcblxuICAgIGNvbnN0IHdhaXRQcm9taXNlID0gYmFja2dyb3VuZFJlZnJlc2gubm9PbGRlclRoYW4oMCk7IC8vIDAgc2Vjb25kc1xuICAgIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSgxMjAwMDApOyAvLyBBZHZhbmNlIHRpbWUgYnkgMiBtaW51dGVzXG5cbiAgICBhd2FpdCBleHBlY3Qod2FpdFByb21pc2UpLnJlamVjdHMudG9UaHJvdygncmVmcmVzaFN0YWNrcyB0b29rIHRvbyBsb25nOyB0aGUgYmFja2dyb3VuZCB0aHJlYWQgbGlrZWx5IHRocmV3IGFuIGVycm9yJyk7XG4gIH0pO1xufSk7XG4iXX0=